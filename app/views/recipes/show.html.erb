<%= render :partial => "layouts/super_show", 
  :locals => 
    { columns: 
      [:id, :user, :name, :ingredients], 
      member: @recipe
    } 
%>

<hr>

<% padded_columns = 7 %>

<div class="wide_table_container">
  <table>
    <tr>
      <th colspan=<%= padded_columns+1 %>>
      </th>
      <th colspan="10">
        Nutrients
      </th>
    </tr>


    <tr>
      <th>Ingredient</td>
      <th>Component</th>
      <th>Url</th>
      <th>Price</th>
      <th>Total Amount</th>
      <th>Serving size</th>
      <th># of Servings</th>
      <th>Price per Servings</th>
      <% Nutrient.all .each do |n| %>
        <td>
          <%= link_to n.name, n %>
        </td>
      <% end %>

    </tr>



    <% @recipe.ingredients.each do |ingredient| %>
      <tr>

        <td><%= link_to "#{ingredient.amount.round(2)} #{ingredient.component.unit.pluralize} of #{ingredient.component.name}", ingredient %></td>
        <td><%= link_to ingredient.component.name, ingredient.component %></td>
        <td><%= link_to "#{ingredient.component.url[0..10]}...", ingredient.component.url %></td>
        <td><%= "$#{ingredient.component.price}"  %> </td>
        <td><%= "#{ingredient.component.total_amount} #{ingredient.component.unit.pluralize}"  %> </td>
        <td><%= "#{ingredient.amount.round(2)} #{ingredient.component.unit.pluralize}"  %> </td>
        <td><%= "#{(ingredient.component.total_amount/ingredient.amount).round(2)}"  %> </td>
        <td><%= "$#{(ingredient.component.price/(ingredient.component.total_amount/ingredient.amount)).round(2)}"  %> </td>

        <% Nutrient.all.each do |nutrient| %>
        <td>
          <%= raw ComponentNutrient.select { |cn| cn.component_id == ingredient.component.id && cn.nutrient_id == nutrient.id }.map{|cn| link_to "#{cn.amount} #{nutrient.unit.pluralize}", cn}.join('') %>
        </td>
        <% end %>
      </tr>
    <% end %>

      <tr>
      <th>FDA RDA </th>
      <td colspan=<%= padded_columns %>> </td>
      <% Nutrient.all .each do |n| %>
        <td>
          <%= "#{n.fda_rda} #{n.unit.pluralize}" %>
        </td>
      <% end %>
    </tr>

    <tr>
      <th>Actual </th>
      <td colspan=<%= padded_columns %>> </td>
      <% Nutrient.all .each do |n| %>
        <td>
          Actual
        </td>
      <% end %>
    </tr>
    <tr>
      <th>RDA %</th>
      <td colspan=<%= padded_columns %> > </td>
      <% Nutrient.all .each do |n| %>
        <td>
          percent
        </td>
      <% end %>
    </tr>
    
  </table>
</div>